# チェンジログ

## [2.3.0] - 2025-01-07 (AIプロンプト大幅改善・ブランド名取得モード追加版)

### 新機能
- **ブランド名取得モード追加**: ASINからブランド名のみを取得する専用モード
  - キーワード抽出とブランド名取得を切り替え可能
  - ブランド名取得時は商品タイトルを非表示
  - CAPTCHA対策として10-15秒の待機時間を自動追加
- **プロンプトテンプレート管理機能**: カスタムプロンプトの作成・編集・削除
  - デフォルトテンプレート（「デフォルト」「シンプル」）は編集不可
  - カスタムプロンプトの追加・名前変更・削除が可能
  - プロンプトごとに異なるキーワード抽出戦略を設定可能
- **キーワードクレンジング機能**: AI生成後の自動クリーニング
  - フレーズ内の重複単語を自動削除（連続・非連続）
  - モード別の語数制限（緩め3語/標準5語/厳しめ6語）
  - 総語数制限（緩め8語/標準12語/厳しめ14語）

### AIプロンプト大幅改善
- **フレーズベース抽出**: 単語ではなく「連続した語のまとまり」を抽出
  - タイトルの語順を保持したフレーズ抽出
  - より自然で検索に有効なキーワード生成
- **厳格制約の追加**: 「違反が1つでもある出力は無効」という強制力のある制約
  - 色・サイズ・型番の除外ルールを厳格化
  - Gemini用の補強ブロック追加
- **優先順位の明確化**: カテゴリ > 特徴 > コレクション > ブランド
- **モード別制約の詳細化**: 各モードの出力個数・語数・総語数を厳密に定義
  - 緩めモード: 2-3フレーズ、各3語以内、総8語
  - 標準モード: 3-4フレーズ、各5語以内、総12語
  - 厳しめモード: 4-6フレーズ、各6語以内、総14語

### ブランド取得機能の改善
- **アメリカAmazon対応**: 複数のセレクターで柔軟に対応
  - `#productOverview_feature_div`セレクター追加
  - `tr.po-brand td.a-span9 span`など8種類のセレクターを順次試行
- **ブランド名クリーニング強化**: 不要テキストの除去
  - 「のストアを表示」「's Store」の除去
  - 「Visit the」「にアクセス」などの除去

### 修正・改善
- **CAPTCHA検出の改善**: より明確なエラーメッセージ
  - 対策方法を具体的に表示
  - CAPTCHAチェックを再追加
- **リクエスト最適化**: シンプルで安定したリクエスト処理
  - 複雑なヘッダーを削除してシンプルに
  - Chrome 91のUser-Agentで安定動作
  - セッション管理を削除して毎回新規リクエスト
- **モード別UI制御**: ブランド名取得モード時に不要な設定を無効化
  - 翻訳モード、抽出モード、ブランドチェック、AI使用を自動無効化
  - 誤操作を防止

### 技術的改善
- プロンプトテンプレートJSON構造の改善（`default_templates`配列追加）
- キーワード検証アルゴリズムのフレーズ対応
- モード別待機時間制御（ブランド取得モード専用）
- ブランドセレクターの優先順位最適化

### 既知の問題
- アメリカAmazonへの連続アクセスでCAPTCHA検出される場合あり
  - 対策: 10-15秒の待機時間を実装済み
  - IPアドレスがブロックされた場合は時間を置くかIP変更が必要

## [2.2.0] - 2024-11-03 (UI改善・機能強化版)

### 新機能
- **プログレスバー表示**: 処理状況が視覚的に分かる進捗バーを追加
  - リアルタイムでパーセンテージ表示
  - 「5 / 10 (50%)」形式の詳細進捗情報
- **ASIN列の追加**: 抽出結果テーブルにASIN列を追加
  - どのASINに対応したキーワードかが一目で分かる
  - ASINコピー機能も追加
- **翻訳モード簡素化**: 「なし」「あり」の2択に変更
  - 自動言語判定で適切な翻訳方向を決定
  - 日本語→英語、英語→日本語を自動選択

### 修正・改善
- **AIプロンプト強化**: ルール違反キーワードの生成を防止
  - 「【絶対に守る制約】」として5つの厳格なルールを追加
  - 説明文生成の完全禁止
- **AIキーワード検証**: 生成されたキーワードの後処理検証機能
  - タイトルに存在しない単語を自動除外
  - 「WF4が制造されたキーワードです」のような不正出力を防止
- **入力レイアウト改善**: ASIN入力ラベルを左端に、地域選択を右側に配置

### UI/UX改善
- **商品タイトル機能完全削除**: ASIN専用ツールとして特化
- **日本語ログ出力**: 処理状況やエラー情報を日本語で表示
- **統計情報リアルタイム更新**: 処理中の統計が即座に更新

### 技術的改善
- AIキーワード検証アルゴリズムの追加
- プログレスバーのスタイル統合
- 翻訳処理の自動言語判定機能

## [2.1.1] - 2024-11-02 (追加修正版)

### 修正・改善
- **AI処理安定性**: キーワード抽出時のタイムアウト問題を改善
  - AI処理失敗時のフォールバック機能を強化
  - エラーハンドリングを追加してプロセス継続性を向上
- **ASIN処理の堅牢性**: 個別ASIN処理のエラー分離
  - 一部ASINの失敗が全体処理に影響しないよう改善
- **デバッグ情報**: 処理状況の透明性向上

### 技術的改善
- Gemini API 2.5-flash モデルへの正式対応
- try-catch ブロックによるエラー処理の強化
- 文字エンコーディング問題の対策

## [2.1.0] - 2024-10-26 (緊急修正版)

### 修正
- **バッチ処理バグ**: 91-99件目がスキップされる問題を修正
  - 重複したコードによる処理エラーを除去
  - 100件処理時に正確に100件すべてが処理されるよう修正
- **Gemini APIモデル**: 2025年版モデルに対応
  - `gemini-2.5-flash`, `gemini-2.0-flash` など最新モデルを追加
  - モデル404エラーによるAIキーワード抽出失敗を修正
  - 複数モデルのフォールバック機能を追加
- **エラーハンドリング強化**: ASIN処理時のエラー詳細表示を追加

### 技術的改善
- モデル選択のロバスト性向上（5つのモデルを順次試行）
- try-catch文による処理継続性の向上
- デバッグ情報の最適化

## [2.0.0] - 2024-10-26

### 新機能
- **ASIN対応**: ASINから商品情報を自動取得する機能を追加
  - Amazon日本・アメリカの両サイトに対応
  - 商品タイトルとブランド名を自動取得
- **翻訳モード簡素化**: 3つのモードに統一
  - なし / 日本語→英語 / 英語→日本語
- **セルクリック機能**: テーブルの個別セルをクリックしてコピー
- **コンソール非表示**: .pywファイルでGUIのみ表示
- **UI改善**:
  - ボタンデザインの向上（絵文字削除、角丸デザイン）
  - 統一された色使い

### 修正
- **キーワード生成問題**: タイトルに存在しない単語の生成を防止
- **翻訳モード表示**: 正しい列に翻訳結果を表示
- **ブランド名抽出**: 正確なHTMLセレクターを使用
- **統計情報更新**: リアルタイムでの統計情報更新
- **セルハイライト**: 個別セル選択時のハイライト表示
- **エンコーディング問題**: ENダッシュ文字の処理改善

### 技術的改善
- Gemini APIとの統合
- プロンプトテンプレート機能
- エラーハンドリングの強化
- レスポンシブデザインの改善

---

## [1.0.0] - 2024-XX-XX

### 初期リリース
- 基本的なキーワード抽出機能
- 翻訳機能
- GUI基本機能